# 黑马点评项目

### 1. 秒杀业务优化

​	思路：一个厨子一个前台

​		先利用Redis完成库存余量、一人一单判断，完成抢单业务

​		再将下单业务放入阻塞队列，利用独立线程异步下单

​	基于阻塞队列的异步秒杀存在哪些问题

​		内存有限制，阻塞队列能够接收到的增加请求是有限的

​		数据安全问题，如果服务器出现了巨大的事故，阻塞队列中存放的数据就会丢失。

### 2. Redis消息队列实现异步秒杀

​	消息队列（Message Queue）:字面意思就是存放消息的队列。最简单的消息队列模型包括三个角色。

​	消息队列：存储和管理消息，也被称为消息代理（Message Broker）

​	生产者：发送消息到消息队列

​	消费者：从消息队列获取消息并处理消息

![image-20230322145842224](C:\Users\Asphyxia\AppData\Roaming\Typora\typora-user-images\image-20230322145842224.png)

MQ相比阻塞队列的优点：

​	MQ是独立于JVM以外的，不受JVM影响，它的储存空间大大地提升了。

​	当服务器出现宕机或者损坏时，MQ可以确保数据的安全。

Redis提供三种不同的方式来实现消息队列：

​	list结构：基于List结构模拟消息队列

​	PubSub：基本的点对点消息模型

​	Stream：比较完善的消息队列模型

#### 		2.1 基于List结构模拟消息队列

​		消息队列（Message Queue），字面意思就是存放消息的队列。而Redis的list数据结构是一个双向链表，很容易模拟出队列效果。

​		队列是入口和出口不在一边，因此我们可以利用：LPUSH 结合 RPOP、或者 RPUSH 结合 LPOP来实现。

​		不过要注意的是，当队列中没有消息时RPOP或者LPOP操作会返回null，并不像JVM的阻塞队列那样会阻塞并等待消息。因此这里应该使用BRPOP或者BLPOP来实现阻塞效果。

#### 	2.2 基于List的消息队列有哪些优缺点？

​		优点：

​			利用Redis存储，不受限于JVM内存上限

​			基于Redis的持久化机制，数据安全性有保证

​			可以满足消息有序性

​		缺点：

​			无法避免消息丢失

​			只支持单消费者

#### 	2.3 基于PubSub的消息队列

​		PubSub（发布订阅）是Redis2.0版本引入的消息传递模型。顾名思义，消费者可以订阅一个或多个channel，生产者向对应channel发送消息后，所有订阅者都能收到相关消息。 

#### 	2.4 基于PubSub的消息队列有哪些优缺点？

​		优点：

​			采用发布订阅模型，支持多生产、多消费

​		缺点：

​			不支持数据持久化

​			无法避免消息丢失

​			消息堆积有上限，超出上限后数据丢失

